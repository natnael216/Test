<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simple Telegram Mini App Example</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: #1e1e2d; /* Telegram-style dark theme */
            color: #fff;
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        ::selection { background: none; }
        html, body { height: 100%; }
        h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #55acee; /* Telegram blue accent */
            text-align: center;
        }
        p {
            white-space: pre-wrap;
            line-height: 1.6;
            margin-top: 20px;
            padding: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }
        #content-wrapper {
            max-width: 100%;
            padding: 0;
            margin: 0;
        }
        .error {
            color: #ff5555;
            text-align: center;
            font-size: 1.2rem;
        }
        #debug {
            color: #888;
            font-size: 0.8rem;
            margin-top: 20px;
            border: 1px solid #444;
            padding: 10px;
            border-radius: 4px;
            display: none; /* Hidden by default */
            max-height: 200px;
            overflow-y: auto;
        }
        button {
            background: #55acee;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px;
        }
        button:hover {
            background: #4a9bd4;
        }
    </style>
</head>
<body>
    <div id="content-wrapper">
        <h1 id="title">Initializing...</h1>
        <p id="content">Waiting for Telegram Web App data...</p>
        <button id="action-btn" style="display: none;">Take Action</button>
        <div id="debug"></div>
    </div>

    <script>
        // Replace with your actual Telegram channel username (without @) for access control
        const ALLOWED_CHANNEL = "grade9_biology"; // e.g., your bot's channel
        const DEBUG_MODE = true; // Set to false for production; true for local/Chrome testing

        // Sample content topics (similar to your biology lessons)
        const topics = {
            "topic1": {
                title: "Sample Topic 1: Introduction to Mini Apps",
                content: `This is a simple Telegram Mini App example.
ይህ ቀላል ቴሌግራም ሚኒ አፕ ምሳሌ ነው።
What is a Mini App? It's a web app inside Telegram!
ሚኒ አፕ ምንድን ነው? በቴሌግራም ውስጥ የድር አፕ ነው!
Click the button below for more interaction.`
            },
            "topic2": {
                title: "Sample Topic 2: Handling Parameters",
                content: `Mini Apps receive data via start_param.
ሚኒ አፕዎች start_param በኩል ውሂብ ይቀበላሉ።
Your param: <span id="param-display"></span>
English and Amharic support for global reach!`
            }
            // Add more topics as needed, e.g., "topic3": { ... }
        };

        // Function to update page content (mirrors your updateContent)
        function updateContent(topicKey, isAuthorized, debugInfo) {
            const titleElement = document.getElementById("title");
            const contentElement = document.getElementById("content");
            const debugElement = document.getElementById("debug");
            const actionBtn = document.getElementById("action-btn");
            const paramDisplay = document.getElementById("param-display");

            // Show debug info if in debug mode
            if (DEBUG_MODE) {
                debugElement.style.display = "block";
                debugElement.textContent = `Debug: ${JSON.stringify(debugInfo, null, 2)}`;
            }

            if (!isAuthorized && !DEBUG_MODE) {
                titleElement.textContent = "Access Denied";
                contentElement.innerHTML = `Access this via our official channel: <a href="https://t.me/${ALLOWED_CHANNEL}" style="color: #55acee;">@${ALLOWED_CHANNEL}</a>`;
                return;
            }

            const topic = topics[topicKey] || topics["topic1"]; // Fallback to first topic
            titleElement.textContent = topic.title;
            contentElement.innerHTML = topic.content.replace("<span id=\"param-display\"></span>", topicKey || "No param");
            paramDisplay ? paramDisplay.textContent = topicKey || "None" : null;

            // Show action button for interaction (e.g., send message back to bot)
            actionBtn.style.display = "block";
            actionBtn.onclick = () => {
                if (window.Telegram?.WebApp) {
                    Telegram.WebApp.showAlert(`Action taken for topic: ${topicKey}!`);
                    // Optional: Send data back to bot via cloud storage or HapticFeedback
                    Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }
            };
        }

        // Initialization (adapted from official Telegram docs)
        document.addEventListener('DOMContentLoaded', () => {
            let topicKey = null;
            let isAuthorized = false;
            let debugInfo = { message: "No Telegram WebApp data available" };

            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready(); // Signal app is ready
                Telegram.WebApp.expand(); // Full-screen mode

                const initData = Telegram.WebApp.initDataUnsafe;
                topicKey = initData?.start_param; // Get topic from launch param
                debugInfo = {
                    initData: initData,
                    user: initData?.user,
                    chat: initData?.chat,
                    chatType: initData?.chat?.type,
                    startParam: topicKey
                };

                // Authorization: Check if launched from allowed channel (basic check)
                if (topicKey && (initData?.chat?.type === "channel" || DEBUG_MODE)) {
                    isAuthorized = true;
                    if (initData?.chat?.username !== ALLOWED_CHANNEL) {
                        debugInfo.warning = `Launched from non-allowed channel: ${initData?.chat?.username}`;
                    }
                } else {
                    debugInfo.error = "Missing start_param or invalid launch context.";
                }

                // Set Telegram theme colors
                Telegram.WebApp.setBackgroundColor('#1e1e2d');
                Telegram.WebApp.setHeaderColor('#1e1e2d');
            }

            // Fallback for browser/Chrome testing (e.g., open in Chrome with ?startapp=topic1)
            if (!topicKey) {
                const urlParams = new URLSearchParams(window.location.search);
                topicKey = urlParams.get("startapp");
                debugInfo.urlParams = topicKey;
                if (DEBUG_MODE) isAuthorized = true;
            }

            updateContent(topicKey, isAuthorized, debugInfo);
        });
    </script>
</body>
</html>
