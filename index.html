<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Grade 9 Biology Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: #1e1e2d; /* Telegram-style dark */
            color: #fff;
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        ::selection { background: none; }
        html, body { height: 100%; }
        h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #55acee;
            text-align: center;
        }
        p {
            white-space: pre-wrap;
            line-height: 1.6;
            margin-top: 20px;
            padding-top: 5px;
            padding-bottom: 5px;
        }
        #content-wrapper {
            max-width: 100%;
            padding: 0;
            margin: 0;
        }
        .error {
            color: #ff5555;
            text-align: center;
            font-size: 1.2rem;
        }
        #debug {
            color: #888;
            font-size: 0.9rem;
            margin-top: 20px;
            border: 1px solid #444;
            padding: 10px;
            display: none; /* Hidden by default */
        }
        @media screen {
            body:after {
                content: '';
                display: block;
                position: fixed;
                top: 0; left: 0;
                width: 100vw; height: 100vh;
                pointer-events: none;
                background: rgba(0, 0, 0, 0);
                z-index: 9999;
            }
        }
    </style>
</head>
<body>
    <div id="content-wrapper">
        <h1 id="title">Initializing...</h1>
        <p id="content">Waiting for Telegram Web App data...</p>
        <div id="debug"></div>
    </div>

    <script>
        // Replace with your actual Telegram channel username (without @)
        const ALLOWED_CHANNEL = "grade9_biology"; // e.g., "MyBiologyChannel"

        // Biology lesson topics
        const topics = {
            "ab1": {
                title: "Unit 1: Introduction to Biology – 1.1 The Meaning and Importance of Biology",
                content: `Biology is the scientific study of life or living things.
ባዮሎጂ ህይወት ወይም የህይወት ያላቸው ነገሮች ሳይንሳዊ ጥናት ነው።
What does it mean to be “alive”?
"ህይወት ያለው" መሆን ማለት ምን ማለት ነው?
It seems very difficult to objectively define life in a simple sentence. But, we recognize life mainly by common characteristics shared by living systems.
ህይወትን በአንድ ቀላል ዓረፍተ ነገር ብቻ መግለፅ በጣም ከባድ ይመስላል። ነገር ግን፣ ህይወትን የምንለየው በዋነኝነት ህይወት ባላቸው ስርዓቶች (living systems) በጋራ በሚታዩ ባህሪያት ነው።
Living things:
- are composed of one or more cells
- በአንድ ወይም ከአንድ በላይ በሆኑ ህዋሳት (cells) የተሠሩ ናቸው።
- are complex and highly ordered
- ውስብስብ እና ከፍተኛ የሆነ ቅደም ተከተል ያላቸው ናቸው።
- can respond to stimuli, grow, reproduce, etc.
- ለአካባቢ ለውጦች (stimuli) ምላሽ መስጠት፣ ማደግ፣ መራባት (reproduce) እና የመሳሰሉትን ማድረግ ይችላሉ።
- transmit genetic information to their offspring
- የዘር መረጃን (genetic information) ወደ ልጆቻቸው ያስተላልፋሉ።
- need the energy to accomplish work
- ሥራ ለማከናወን ኃይል (energy) ያስፈልጋቸዋል።
- can maintain relatively constant internal conditions (homeostasis)
- ውስጣዊ ሁኔታቸውን በአንፃራዊነት ቋሚ አድርገው ማቆየት ይችላሉ (ሆሞስታሲስ - homeostasis)።
- are capable of evolutionary adaptation to the environment
- ለአካባቢያቸው የዝግመተ ለውጥ (evolutionary) መላመድ የመቻል ችሎታ አላቸው።`
            },
            "ab2": {
                title: "Unit 1: Introduction to Biology – 1.2 The Methods of Studying Biology",
                content: `What is a scientific study?
(ሳይንሳዊ ጥናት ማለት ምን ማለት ነው?)
Biologists study living things using a scientific method that involves asking questions, suggesting possible answers, and testing for the validity of the answers through experimentation.
ባዮሎጂስቶች ስለ ህይወት ያላቸው ነገሮች የሚያጠኑት ሳይንሳዊ ስነ-ዘዴን (scientific method) በመጠቀም ሲሆን፣ ይህ ስነ-ዘዴ ጥያቄዎችን መጠየቅ፣ ሊሆኑ የሚችሉ መልሶችን መጠቆም እና መልሶቹ ትክክል መሆናቸውን በሙከራ (experimentation) ማረጋገጥን ያካትታል።`
            },
            "ab3": {
                title: "Unit 1: Introduction to Biology – 1.3 The Branches of Biology",
                content: `What comes to your mind when you hear the word science?
"ሳይንስ" የሚለውን ቃል ሲሰሙ ወደ አእምሮዎ የሚመጣው ምንድን ነው?
Biologists are always curious about why things happen or how things happen. By asking questions and seeking science-based responses known as the scientific method, they come up with new theories to explain new findings.
ባዮሎጂ ባለሙያዎች (Biologists) ነገሮች ለምን እንደሚሆኑ ወይም እንዴት እንደሚከሰቱ ሁል ጊዜ ጉጉት አላቸው። ሳ዇ንሳዊ ስነ-ዘዴ (the scientific method) በመባል የሚታወቀውን፣ ጥያቄዎችን በመጠየቅ እና በሳይንስ ላይ የተመሠረተ ምላሽ በመፈለግ አዲስ ግኝቶችን (new findings) ለማስረዳት አዲስ ቲዎሪዎችን (theories) ይፈጥራሉ።`
            }
            // Add more topics here, e.g., "ab4": { title: "New Topic", content: "Content..." }
        };

        // Function to update page content
        function updateContent(topicKey, isAuthorized, debugInfo) {
            const titleElement = document.getElementById("title");
            const contentElement = document.getElementById("content");
            const debugElement = document.getElementById("debug");

            // Show debug info
            debugElement.style.display = "block";
            debugElement.textContent = `Debug Info: ${JSON.stringify(debugInfo, null, 2)}`;

            if (!isAuthorized) {
                titleElement.textContent = "Access Denied";
                contentElement.innerHTML = `This content is only available via our official channel: <a href="https://t.me/${ALLOWED_CHANNEL}" style="color: #55acee;">@${ALLOWED_CHANNEL}</a>`;
                return;
            }

            const topic = topics[topicKey];
            if (topic) {
                titleElement.textContent = topic.title;
                contentElement.textContent = topic.content;
            } else {
                titleElement.textContent = "Grade 9 Biology Tutorials";
                contentElement.innerHTML = `Topic not found. Please select a valid topic from <a href="https://t.me/${ALLOWED_CHANNEL}" style="color: #55acee;">@${ALLOWED_CHANNEL}</a>.<br>Available topics:<br>` +
                    Object.keys(topics).map(key => `<a href="https://t.me/hkfdd_bot?startapp=${key}" style="color: #55acee;">${topics[key].title}</a>`).join("<br>");
            }
        }

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            let topicKey = null;
            let isAuthorized = false;
            let debugInfo = { message: "No Telegram WebApp data available" };

            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();

                const initData = Telegram.WebApp.initDataUnsafe;
                topicKey = initData?.start_param;
                debugInfo = {
                    initData: initData,
                    chat: initData?.chat,
                    chatType: initData?.chat?.type,
                    chatUsername: initData?.chat?.username,
                    startParam: topicKey
                };

                // Check if launched from the allowed channel
                const chat = initData?.chat;
                if (chat && chat.type === "channel" && chat.username === `@${ALLOWED_CHANNEL}`) {
                    isAuthorized = true;
                } else {
                    debugInfo.error = `Channel mismatch. Expected: @${ALLOWED_CHANNEL}, Got: ${chat?.username || 'none'}`;
                }

                Telegram.WebApp.setBackgroundColor('#1e1e2d');
                Telegram.WebApp.setHeaderColor('#1e1e2d');
            }

            // Fallback for browser testing (remove in production)
            if (!topicKey) {
                const urlParams = new URLSearchParams(window.location.search);
                topicKey = urlParams.get("startapp");
                debugInfo.urlParams = topicKey;
                // Simulate channel for testing (comment out in production)
                // isAuthorized = true;
            }

            updateContent(topicKey, isAuthorized, debugInfo);
        });
    </script>
</body>
</html>

